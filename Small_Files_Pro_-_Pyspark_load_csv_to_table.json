{"paragraphs":[{"text":"%sql\nshow databases","user":"admin","dateUpdated":"2022-12-21T18:42:36+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":158,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"databaseName":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":"databaseName\ndefault\ninformation_schema\nsmallfiles\nsys"}]},"apps":[],"jobName":"paragraph_1671570916407_406365396","id":"20221215-224405_1766853746","dateCreated":"2022-12-20T21:15:16+0000","dateStarted":"2022-12-21T18:41:50+0000","dateFinished":"2022-12-21T18:42:25+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:54"},{"text":"%sql\nCREATE DATABASE IF NOT EXISTS smallfiles","user":"admin","dateUpdated":"2022-12-20T21:15:16+0000","config":{"editorSetting":{"language":"sql","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/sql","fontSize":9,"results":{"0":{"graph":{"mode":"table","height":174,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TABLE","data":""}]},"apps":[],"jobName":"paragraph_1671570916407_-1381243349","id":"20221215-224654_681035627","dateCreated":"2022-12-20T21:15:16+0000","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:55"},{"title":"Criação do schema, verificação dos dados do csv e criação da tabela parquet","text":"%pyspark\nimport pyspark\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql import Row\nfrom pyspark.sql.types import StructType\nappName= \"hive_pyspark\"\nmaster= \"yarn\"\n\nspark = SparkSession.builder \\\n\t    .master(master).appName(appName).enableHiveSupport().getOrCreate()\n        \ntblSchema = StructType() \\\n                .add(\"path\", \"string\")\\\n                .add(\"size_bytes\", \"integer\")\\\n                .add(\"nro_blocks\", \"integer\")\\\n                .add(\"status\", \"string\")\\\n                .add(\"extract_dt\", \"date\")\n                \ntblData = spark.read.csv(\"hdfs://cdp.18.224.174.227.nip.io:8020/tmp/final_fsck_extract\", schema=tblSchema)\n\ntblData.cache()\n\ntblData.count()\\\n\ncatalyst_plan = tblData._jdf.queryExecution().logical()\n\nsize_bytes = spark._jsparkSession.sessionState().executePlan(catalyst_plan).optimizedPlan().stats().sizeInBytes()\n\nspark.sql(\"DROP TABLE IF EXISTS smallfiles.fsck_smallfiles\")\n\n# Parquet Snappy Compression Ratio 68% (128M + PSCR) and partitioned by extraction date:\nif size_bytes >= 225485783:\n    tblData.write.format('parquet').option('compression','snappy').partitionBy('extract_dt').saveAsTable('smallfiles.fsck_smallfiles')\n    \nelse:\n    tblData.write.format(\"parquet\").saveAsTable(\"smallfiles.fsck_smallfiles\")\n    \ntblData.unpersist()","user":"admin","dateUpdated":"2022-12-23T19:25:50+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":113.15,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{}},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"DataFrame[path: string, size_bytes: int, nro_blocks: int, status: string, extract_dt: date]"}]},"apps":[],"jobName":"paragraph_1671570916407_-1423587636","id":"20221215-224737_1725766986","dateCreated":"2022-12-20T21:15:16+0000","dateStarted":"2022-12-23T19:16:20+0000","dateFinished":"2022-12-23T19:16:22+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:56"},{"title":"Verificação dos dados da tabela","text":"%pyspark\nimport pyspark\nfrom pyspark.sql import SparkSession\nfrom pyspark.sql import Row\nappName= \"hive_pyspark\"\nmaster= \"yarn\"\n\nspark = SparkSession.builder \\\n\t.master(master).appName(appName).enableHiveSupport().getOrCreate()\n\ntblraw=spark.sql(\"select * from smallfiles.fsck_smallfiles limit 5\")\ntblraw.show()\n\ntblrawdesc=spark.sql(\"show create table smallfiles.fsck_smallfiles\")\ntblrawdesc.show(truncate=False)\n\ntbl=spark.sql(\"select * from smallfiles.fsck_smallfiles where extract_dt='2022-12-20' limit 5\")\ntbl.show()\n\ntbl=spark.sql(\"select * from smallfiles.fsck_smallfiles where extract_dt='2022-12-21' limit 5\")\ntbl.show()","user":"admin","dateUpdated":"2022-12-23T19:16:27+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":6,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":358,"optionOpen":false,"setting":{"table":{"tableGridState":{"columns":[{"name":"path","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"size_bytes","visible":true,"width":"*","sort":{"priority":0,"direction":"desc"},"filters":[{}],"pinned":""},{"name":"nro_blocks","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"status","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""},{"name":"extract_dt","visible":true,"width":"*","sort":{},"filters":[{}],"pinned":""}],"scrollFocus":{},"selection":[],"grouping":{"grouping":[],"aggregations":[],"rowExpandedStates":{}},"treeView":{},"pagination":{"paginationCurrentPage":1,"paginationPageSize":250}},"tableColumnTypeState":{"names":{"path":"string","size_bytes":"string","nro_blocks":"string","status":"string","extract_dt":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false},"multiBarChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"stackedAreaChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"},"lineChart":{"rotate":{"degree":"-45"},"xLabelStatus":"default"}},"commonSetting":{},"keys":[{"name":"path","index":0,"aggr":"sum"}],"groups":[],"values":[{"name":"size_bytes","index":1,"aggr":"sum"}]},"helium":{}},"1":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"path":"string","size_bytes":"string","nro_blocks":"string","status":"string","extract_dt":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+----------+------+----------+\n|                path|size_bytes|nro_blocks|status|extract_dt|\n+--------------------+----------+----------+------+----------+\n|/hbase/.tmp/hbase...|       208|         1|    OK|2022-12-20|\n|/hbase/.tmp/hbase...|       208|         1|    OK|2022-12-22|\n|/hbase/MasterData...|        83|         1|    OK|2022-12-20|\n|/hbase/MasterData...|        83|         1|    OK|2022-12-22|\n|/hbase/MasterData...|       326|         1|    OK|2022-12-20|\n+--------------------+----------+----------+------+----------+\n\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|createtab_stmt                                                                                                                                                                                                                                                                                              |\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n|CREATE TABLE `smallfiles`.`fsck_smallfiles` (`path` STRING, `size_bytes` INT, `nro_blocks` INT, `status` STRING, `extract_dt` DATE)\nUSING parquet\nOPTIONS (\n  `serialization.format` '1',\n  path 'hdfs://cdp.18.224.174.227.nip.io:8020/warehouse/tablespace/external/hive/smallfiles.db/fsck_smallfiles'\n)\n|\n+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+\n\n+--------------------+----------+----------+------+----------+\n|                path|size_bytes|nro_blocks|status|extract_dt|\n+--------------------+----------+----------+------+----------+\n|/hbase/.tmp/hbase...|       208|         1|    OK|2022-12-20|\n|/hbase/MasterData...|        83|         1|    OK|2022-12-20|\n|/hbase/MasterData...|       326|         1|    OK|2022-12-20|\n|/hbase/MasterData...|        34|         1|    OK|2022-12-20|\n|/hbase/MasterData...|      6523|         1|    OK|2022-12-20|\n+--------------------+----------+----------+------+----------+\n\n+--------------------+----------+----------+------+----------+\n|                path|size_bytes|nro_blocks|status|extract_dt|\n+--------------------+----------+----------+------+----------+\n|/hbase/MasterData...|       326|         1|    OK|2022-12-21|\n|/hbase/MasterData...|        34|         1|    OK|2022-12-21|\n|/hbase/MasterData...|      5026|         1|    OK|2022-12-21|\n|/hbase/MasterData...|         0|         0|    OK|2022-12-21|\n|/hbase/archive/da...|      5610|         1|    OK|2022-12-21|\n+--------------------+----------+----------+------+----------+"}]},"apps":[],"jobName":"paragraph_1671570916408_-666000768","id":"20221215-225135_1624451174","dateCreated":"2022-12-20T21:15:16+0000","dateStarted":"2022-12-23T19:16:27+0000","dateFinished":"2022-12-23T19:16:29+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:57"}],"name":"Small Files/Pro - Pyspark load csv to table","id":"2HM5ST3T9","noteParams":{},"noteForms":{},"angularObjects":{"sh:admin:":[],"livy:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":true,"looknfeel":"default","personalizedMode":"false"},"info":{}}